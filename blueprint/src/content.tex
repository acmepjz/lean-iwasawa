% In this file you should put the actual content of the blueprint.
% It will be used both by the web and the print version.
% It should *not* include the \begin{document}
%
% If you want to split the blueprint content into several files then
% the current file can be a simple sequence of \input. Otherwise It
% can start with a \section or \chapter for instance.

\tableofcontents

\section{Introduction}

\subsection{Iwasawa's theorem on growth of class groups}

The first goal of this project is formalize the proof of
Iwasawa's theorem on growth of class groups in a $\BZ_p$-extension tower
in {\Lean}.

\begin{definition}
\label{Zp-ext-def}
Let $K$ be a field, $p$ be a prime.

{\rm(i)} An extension $K_\infty/K$ is called a $\BZ_p$-extension,
if it is Galois with $\Gamma=\Gal(K_\infty/K)\cong\BZ_p$
as topological groups.

{\rm(ii)} If $K_\infty/K$ is a $\BZ_p$-extension, then for any
$n\geq 0$, define $K_n:=K_\infty^{\Gamma^{p^n}}$.
\end{definition}

\begin{thm}[Iwasawa's theorem]
\label{clgp-growth}
\uses{Zp-ext-def,coinvariant-growth}
Let $K$ be a number field, $p$ be a prime,
$K_\infty/K$ be a $\BZ_p$-extension.
Then there exist integers $\lambda,\mu,\nu$
such that for all sufficiently large $n$,
$\ord_p(\#\Cl(K_n))=\lambda n+\mu p^n+\nu$.
\end{thm}

\section{Preliminaries in commutative algebra}

\begin{prop}
\label{noeth-ring-filtration}
Let $A$ be a Noetherian ring and $M$ be a finitely generated $A$-module.
Then there exists a chain of submodules of $M$
\[0 = M_0 \subset M_1 \subset \cdots \subset M_n = M\]
such that for each $1\leq i\leq n$, $M_i/M_{i-1} \cong A/\fp_i$ for some prime ideal $\fp_i\in\Spec(A)$.
\end{prop}

\begin{proof}
When $M=0$ we take $n=0$ and there is nothing to prove.
When $M\neq 0$ we have $\Ass(M)\neq\varnothing$
and we can take $\fp_1$ be any element in $\Ass(M)$
and we obtain $M_1:=A/\fp_1\hookrightarrow M$.
If $M_1\neq M$, do the same for $M/M_1$ to get $M_2/M_1\cong A/\fp_2\hookrightarrow M/M_1$.
Since $M$ is a Noetherian $A$-module,
the chain $M_1\subset M_2\subset\cdots$ must stop after a finite number of steps.
\end{proof}

\begin{thm}[Krull's Hauptidealsatz]
\label{krull-principal-ideal-thm}
Let $A$ be a Noetherian ring.
If $\fa=(a_1,\cdots,a_n)$ is an ideal of $A$ generated by $n$ elements,
and $\fp$ is a minimal prime over-ideal of $\fa$, then $\height(\fp)\leq n$.

Conversely, if $\fp$ is a prime ideal of $A$ of height $\leq n$,
then there exists an ideal $\fa$ of $A$ generated by $n$ elements, such that
$\overline\fp$ is a minimal prime in $A/\fa$.
\end{thm}

This is WIP in \PR{22403}.

\begin{proof}
If $\fp$ is a minimal prime over-ideal of $\fa$, then $\fa A_\fp\subset\fp A_\fp$,
and $\fp(A_\fp/\fa A_\fp)$, which is the only maximal ideal of
$A_\fp/\fa A_\fp$, is also a minimal prime ideal.
Therefore $A_\fp/\fa A_\fp$ is Artinian, and so
$\fa A_\fp$ is an open ideal. It follows that $\height(\fp)=\dim(A_\fp)\leq n$.

Conversely, if $\fp$ is a prime ideal of height $\leq n$,
then $\dim(A_\fp)\leq n$, so there exists an \emph{ideal of definition}
$IA_\fp$ of $A_\fp$
(i.e.~an open ideal with respect to $\fp A_\fp$-adic topology),
generated by $n$ elements.
Clearing their denominators we may assume that the generators take the form
$\frac{x_1}s,\cdots,\frac{x_n}s$ for some $x_1,\cdots,x_n\in I$
and $s\in A\setminus\fp$.
Since $\fp^NA_\fp\subset IA_\fp\subset\fp A_\fp$ for some integer $N\geq 1$,
we obtain $\fp^N\subset I\subset\fp$, and
$IA_\fp=(x_1,\cdots,x_n)A_\fp$
(hence we may replace $I$ by $(x_1,\cdots,x_n)$), and that $\fp$ is a minimal prime over-ideal of $I$
(since if $I\subset\fp'\subset\fp$ for some prime ideal $\fp'$,
then $\fp^N\subset\fp'$, hence $\fp\subset\fp'$, so $\fp=\fp'$).
\end{proof}

\begin{thm}
\label{UFD-iff-ht-1-principal}
\uses{krull-principal-ideal-thm}
Let $A$ be a Noetherian domain. Then $A$ is a UFD if and only if every prime ideal of height $1$ is principal
(recall that a prime ideal $\fp$ is of height $1$ if $\fp \neq 0$ and there is no prime ideal lies in between $0$ and $\fp$).
\end{thm}

\begin{proof}
``$\Rightarrow$'':
Let $\fp$ be a prime ideal of height $1$,
and let $a\in\fp$ be a non-zero element.
Factor $a$ into a product of irreducible elements
(= prime elements) $a=p_1\cdots p_r$.
Then by $a\in\fp$ we obtain $p_i\in\fp$ for some $i$,
since $(\fp_i)\neq 0$ is a prime ideal contained in $\fp$, we have $\fp=(p_i)$.

``$\Leftarrow$'':
It suffices to show that every irreducible element is prime.
Let $p\in A$ be irreducible, and $\fp$ be a prime ideal of $A$ minimal containing $p$.
Then $\fp$ is of height $1$ by Krull's Hauptidealsatz
(Theorem \ref{krull-principal-ideal-thm}),
so $\fp=(\pi)$ is principal.
Since $p\in\fp=(\pi)$, $\pi\mid p$, and since $p$ is irreducible,
$p=u\pi$ for some unit $u$, therefore $p$ is prime (which generates $\fp$).
\end{proof}

\begin{thm}
\label{regular-local-ring-is-UFD}
A regular local ring is a UFD.
\end{thm}

\section{Structure of module up to pseudo-isomorphism}

\subsection{Characteristic ideal}

\begin{prop}
\label{char-ideal-preliminary}
\uses{noeth-ring-filtration}
Let $A$ be a Noetherian ring, $M$ be a
finitely generated torsion $A$-module.
Then for any height one prime $\fp$ of $A$,
$M_\fp$ is an $A_\fp$-module of finite length. Moreover, there are only finitely
many height one primes $\fp$ of $A$ such that $M_\fp\neq 0$.
\end{prop}

\begin{proof}
By Proposition \ref{noeth-ring-filtration},
we may let $0=M_0\subset M_1\subset\cdots\subset M_n=M$ be a filtration of $M$
such that for each $1\leq i\leq n$,
$M_i/M_{i-1}\cong A/\fp_i$ for some prime ideal $\fp_i$ of $A$.
Note that if $\fp,\fq$ are prime ideals of $A$,
then $(A/\fp)_\fq\neq 0$ if and only if $\fp\subset\fq$.
Therefore by $M$ is torsion $A$-module, we obtain that $\height(\fp_i)\geq 1$
for all $1\leq i\leq n$,
and if $\fp$ is a height one prime, then $M_\fp\neq 0$
if and only if $\fp_i\subset\fp$ for some $i$,
by height considerations this means that $\fp_i=\fp$ for some $i$,
hence such $\fp$ are only finitely many.

To prove $\ell_{A_\fp}(M_\fp)<\infty$,
we only need to show that if $\fp,\fq$ are prime ideals of $A$
such that $\height(\fp)\geq 1$ and $\height(\fq)=1$,
then $(A/\fp)_\fq$ is an $A_\fq$-module of finite length.
In fact, by height considerations we know that $(A/\fp)_\fq\neq 0$
if and only if $\fp=\fq$, in this case $(A/\fq)_\fq=A_\fq/\fq A_\fq
=k(\fq)$ is the residue field of $\fq$, which is
an $A_\fq$-module of length one.

(\emph{Another proof without using Proposition \ref{noeth-ring-filtration}.}
Note that $M_\fp=0$ for all minimal prime ideals of $A$,
therefore if $\fp$ is of height one such that $M_\fp\neq 0$,
then $\fp$ is a minimal element in $\Supp(M)$, hence $\fp\in\Ass(M)$
which is a finite set.
So there are only finitely
many height one primes $\fp$ of $A$ such that $M_\fp\neq 0$.

Suppose $\fp$ is a height one prime such that $M_\fp\neq 0$.
To prove that $M_\fp$ is an $A_\fp$-module of finite length,
we only need to prove that the ring $A_\fp/\Ann_{A_\fp}(M_\fp)$
is Artinian. Note that $\Ann_{A_\fp}(M_\fp)=\Ann_A(M)_\fp$,
hence $A_\fp/\Ann_{A_\fp}(M_\fp)=(A/\Ann_A(M))_\fp$
whose prime ideals are one-to-one correspondence to prime ideals
of $A$ between $\Ann_A(M)$ and $\fp$,
i.e.~prime ideals in $\Supp(M)$ which is contained in $\fp$.
Such ideal can only be $\fp$ itself,
since $M$ is torsion, every prime ideal in $\Supp(M)$ has height $\geq 1$.
Hence $A_\fp/\Ann_{A_\fp}(M_\fp)$
is Artinian.)
\end{proof}

In particular, this allows us to define the \emph{characteristic ideal} of $M$.

\begin{definition}
\label{char-ideal}
\uses{char-ideal-preliminary}
Let $A$ be a Noetherian ring, $M$ be a
finitely generated torsion $A$-module.
The \emph{characteristic ideal} of $M$,
denoted by $\chaR_A(M)$, or simply $\chaR(M)$ if there is no risk of confusion, is defined to be
$$
\chaR_A(M):=\prod_{\substack{\fp\in\Spec(A)\\
\height(\fp)=1}}\fp^{\ell_{A_\fp}(M_\fp)}.
$$
\end{definition}

\begin{prop}
\label{char-ideal-additive}
\uses{char-ideal}
Let $A$ be a Noetherian ring.
Let $0\to M'\to M\to M''\to 0$ be a short exact sequence of finitely generated $A$-modules. Then $M$ is $A$-torsion if and only if $M'$ and $M''$ are $A$-torsion.
If $M$ is $A$-torsion, then $\chaR_A(M)=\chaR_A(M')\chaR_A(M'')$.
\end{prop}

\begin{proof}
Since localization is exact, for any prime ideal $\fp$ of $A$,
the $0\to M_\fp'\to M_\fp\to M_\fp''\to 0$ is exact.
Let $\fp$ runs over all minimal prime ideals of $A$,
we obtain that $M$ is $A$-torsion if and only if $M'$ and $M''$ are $A$-torsion.
Also, we have $\ell_{A_\fp}(M_\fp)=\ell_{A_\fp}(M_\fp')+\ell_{A_\fp}(M_\fp'')$,
hence $\chaR_A(M)=\chaR_A(M')\chaR_A(M'')$ holds.
\end{proof}

\subsection{Pseudo-null module}

\begin{definition}
\label{pseudo-null}
\lean{Module.IsPseudoNull, LinearMap.IsPseudoIsomorphism, Module.IsPseudoIsomorphic}
\leanok
Let $A$ be a Noetherian ring.

{\rm(i)}
A finitely generated $A$-module $M$ is called a \emph{pseudo-null} $A$-module,
if $M_\fp=0$ for all prime ideals $\fp$ of $A$ of height $\leq 1$.

{\rm(ii)}
An $A$-linear homomorphism $f:M\to N$ between finitely generated $A$-modules
is called a \emph{pseudo-isomorphism} (\emph{pis} for short),
if its kernel and cokernel are pseudo-null $A$-modules.

{\rm(iii)}
Two finitely generated $A$-modules $M,N$ are called
\emph{pseudo-isomorphic} (\emph{pis} for short),
denoted by $M\sim_\pis N$ or simply $M\sim N$,
if there exists a pseudo-isomorphism from $M$ to $N$.
\end{definition}

\begin{remark}
We warn the reader that $M\sim N$ not necessarily implies $N\sim M$.
\end{remark}

\begin{prop}
\label{pseudo-null-criterion}
\uses{pseudo-null}
Let $A$ be a Noetherian ring, $M$ be a finitely generated $A$-module.

{\rm(i)} If $A$ is of Krull dimension $\leq 1$, then $M$ is pseudo-null
if and only if $M=0$.

{\rm(ii)} If $A$ is of Krull dimension $2$, then $M$ is pseudo-null
if and only if the cardinality of $M$ is finite (???).
\end{prop}

\begin{prop}
\label{pseudo-null-char-ideal}
\uses{pseudo-null,char-ideal-additive}
Let $A$ be a Noetherian ring, $M$, $N$ be finitely generated torsion $A$-modules.

{\rm(i)} If $M$ is pseudo-null, then $\chaR_A(M)=0$.

{\rm(ii)} If $M\sim N$, then $\chaR_A(M)=\chaR_A(N)$.
\end{prop}

\begin{proof}
Clear from definition and Proposition \ref{char-ideal-additive}.
\end{proof}

\subsection{Structure theorem}

\begin{definition}
\label{ht-1-localization-is-PID}
Let $A$ be a Noetherian ring.
We say that the height one localization of $A$ is PID (?), if
\begin{equation}
\label{eqn:ht-1-localization-is-PID}
\begin{array}{l}
\text{For any finitely many height one primes $\fp_1,\cdots,\fp_r$ of $A$,}\\
\text{let $S:=A\setminus\bigcup_{i=1}^r\fp_i$, then $S^{-1}A$ is a PID.}
\end{array}
\end{equation}
\end{definition}

\begin{lem}
\label{pis-iff}
\uses{char-ideal-preliminary,pseudo-null}
Let $A$ be a Noetherian ring and let
$M,N$ be finitely generated torsion $A$-modules.
Let $\Sigma=\{\fq_1,\cdots,\fq_r\}
=\{\fq\in\Supp(M)\cup\Supp(N)\mid\height(\fq)=1\}$
(by Proposition \ref{char-ideal-preliminary} this is a finite set).
Let $S:=A\setminus\bigcup_{i=1}^r\fq_i$ which is a multiplicative subset of $A$.
Let $f:M\to N$ be an $A$-module homomorphism.
Then $f$ is a pseudo-isomorphism if and only if $S^{-1}f:S^{-1}M\to S^{-1}N$
is an isomorphism.
\end{lem}

\begin{proof}
Since the height one support of $\ker(f)$ and $\coker(f)$
are contained in $\Sigma$,
and since $S^{-1}\ker(f)=\ker(S^{-1}f)$,
$S^{-1}\coker(f)=\coker(S^{-1}f)$ (localization is exact),
we only need to prove that if $M$ is a finitely generated torsion $A$-module
whose height one support is contained in $\Sigma$,
then $S^{-1}M=0$ if and only if $M$ is pseudo-null (equivalently, $M_\fq=0$
for all $\fq\in\Sigma$):
``$\Rightarrow$'': Clear.
``$\Leftarrow$'': For all $\fq\in\Sigma$, $M_\fq=0$ means that $\Ann(M)\not\subset\fq$,
since $\fq$ are prime ideals, we have $\Ann(M)\not\subset\bigcup_{\fq\in\Sigma}\fq$,
so $S^{-1}M=0$.
\end{proof}

\begin{prop}[Structure theorem of finitely generated torsion $A$-modules]
\label{structure-thm}
\uses{ht-1-localization-is-PID,char-ideal,pseudo-null}
Let $A$ be a Noetherian ring satisfying \eqref{eqn:ht-1-localization-is-PID}
and let $M$ be a finitely generated torsion $A$-module.
Then there exist height one primes $\fp_1,\cdots,\fp_s$ of $A$
and positive integers $k_1,\cdots,k_s$, such that there exists a pseudo-isomorphism
$M\to\bigoplus_{i=1}^s A/\fp_i^{k_i}$.
Moreover, the sequence $(\fp_i^{k_i})_{i=1}^s$ is unique up to ordering.
\end{prop}

\begin{proof}
Let
$\Sigma=\{\fq_1,\cdots,\fq_r\}=\{\fq\in\Supp(M)\mid\height(\fq)=1\}$
(by Proposition \ref{char-ideal-preliminary} this is a finite set),
and let $S=A\setminus\bigcup_{i=1}^r\fq_i$.
Then $S^{-1}M$ is a finitely generated $S^{-1}A$-module,
and is torsion (for example, since $\Hom_{S^{-1}A}(S^{-1}M,S^{-1}A)
=S^{-1}\Hom_A(M,A)=0$).

Note that the prime ideals $\fP$ of $S^{-1}A$ are one-to-one correspondence
to prime ideals $\fp$ of $A$ satisfying $\fp\cap S=\varnothing$
(i.e.~$\fp\subset\bigcup_{i=1}^r\fq_i$, i.e~$\fp\subset\fq_i$ for some $i$),
by $\fP=S^{-1}\fp$ and $\fp=\fP\cap A$.
In particular, $S^{-1}A$ is of dimension $\leq 1$.

By structure theorem of finitely generated torsion modules over a PID,
there exist primes $\fp_1,\cdots,\fp_s$ of $A$
satisfying $\fp_i\cap S=\varnothing$,
and positive integers $k_1,\cdots,k_s$, such that
there exists an isomorphism
$g:S^{-1}M\xrightarrow\sim\bigoplus_{i=1}^sS^{-1}(A/\fp_i^{k_i})$
of $S^{-1}A$-modules.
Since $S^{-1}M$ is torsion, the $\fp_i$'s must be of height one.
Since $\Hom_{S^{-1}A}(S^{-1}M,\bigoplus_{i=1}^sS^{-1}(A/\fp_i^{k_i}))
=S^{-1}\Hom_A(M,\bigoplus_{i=1}^sA/\fp_i^{k_i})$,
by multiplying an element of $S$ to $g$ if necessary
(this doesn't change the fact that $g$ is an isomorphism), we may find
an $A$-linear map $f:M\to\bigoplus_{i=1}^sA/\fp_i^{k_i}$
such that $g=S^{-1}f$.
Now by (i) we know that $f$ is a pseudo-isomorphism.

Conversely, if $(\fp_i^{k_i})_{i=1}^s$ is such that there exists a
pseudo-isomorphism
$M\to\bigoplus_{i=1}^s A/\fp_i^{k_i}$,
then enlarging $S$ if necessary, by Lemma \ref{pis-iff},
its localization
$S^{-1}M\to\bigoplus_{i=1}^sS^{-1}(A/\fp_i^{k_i})$
is an isomorphism of $S^{-1}A$-module, hence by
structure theorem of finitely generated torsion modules over a PID,
the $(\fp_i^{k_i})_{i=1}^s$ is unique up to ordering.
\end{proof}

\begin{prop}
\label{pis-symm}
\uses{ht-1-localization-is-PID,pis-iff}
Let $A$ be a Noetherian ring satisfying \eqref{eqn:ht-1-localization-is-PID}.
Let $M,N$ be finitely generated torsion $A$-modules.
Then the followings are equivalent:
\begin{itemize}
\item[(a)]
There exists a pseudo-isomorphism $M\to N$.
\item[(b)]
For any height one prime $\fp$ of $A$, we have $M_\fp\cong N_\fp$.
\end{itemize}
In particular, if there exists a pseudo-isomorphism $M\to N$,
then there also exists a pseudo-isomorphism $N\to M$.
\end{prop}

\begin{proof}
(a)$\Rightarrow$(b): Clear.

(b)$\Rightarrow$(a): Let $\Sigma=\{\fq_1,\cdots,\fq_r\}
=\{\fq\in\Supp(M)\cup\Supp(N)\mid\height(\fq)=1\}$
(by Proposition \ref{char-ideal-preliminary} this is a finite set),
and let $S=A\setminus\bigcup_{i=1}^r\fq_i$.
Since $M_\fp\cong N_\fp$ for all height one primes $\fp$ of $A$,
the $S^{-1}M$ and $S^{-1}N$, being finitely generated torsion modules over
a PID $S^{-1}A$, are isomorphic. Say $g:S^{-1}M\xrightarrow\sim S^{-1}N$
is an isomorphism of $S^{-1}A$-modules.
Since $\Hom_{S^{-1}A}(S^{-1}M,S^{-1}N)=S^{-1}\Hom_A(M,N)$,
by multiplying an element of $S$ to $g$ if necessary
(this doesn't change the fact that $g$ is an isomorphism), we may find
an $A$-linear map $f:M\to N$
such that $g=S^{-1}f$.
Now by Lemma \ref{pis-iff} we know that $f$ is a pseudo-isomorphism.
\end{proof}

\subsection{Noetherian regular domain}

\begin{lem}
\label{semilocal-PID}
Let $A$ be a semilocal (i.e.~only finitely many maximal ideals)
integral domain which is not a field,
such that for every maximal ideal $\fp$ of $A$, $A_\fp$ is a PID.
Then $A$ itself is a PID.
\end{lem}

\begin{proof}
Hint: for a maximal ideal
$\fp$ of $A$, $A_\fp$ is a PID, hence by Krull's intersection theorem,
$\bigcap_{n\geq 0}\fp^nA_\fp=0$,
and in particular, $\fp\supsetneqq\fp^2$. By Chinese remainder theorem,
for each $\fp$ we can choose $\pi_\fp\in A$ such that
$\pi_\fp\in\fp\setminus\fp^2$ and $\pi_\fp\equiv 1\pmod{\fq}$
for all maximal ideals $\fq\neq\fp$.
Prove that $\pi_\fp$ is a generator of $\fp A_\fp$ as an ideal of $A_\fp$.
Similar to Homework 3.3 (TODO),
prove that if $\fa$ is an ideal of $A$, then
$\fa=\bigcap_\fp\fa A_\fp\subset\Frac(A)$ where $\fp$ runs over all maximal ideals
of $A$.
Now if $\fa\neq 0$, then for each maximal ideal $\fp$ of $A$,
there exists $f_\fp\in A_\fp\setminus\{0\}$ such that $\fa A_\fp=f_\fp A_\fp$,
and we may choose $f_\fp$ such that $f_\fp\in A\setminus\{0\}$.
Let $e_\fp\geq 0$
be the integer such that $f_\fp\in\fp^{e_\fp}\setminus\fp^{e_\fp+1}$.
Let $f=\prod_\fp\pi_\fp^{e_\fp}$ where $\fp$ runs over all maximal ideals
of $A$.
Prove that $fA_\fp=f_\fp A_\fp$ for all maximal ideals $\fp$ of $A$,
which enables us to deduce that $(f)=\bigcap_\fp fA_\fp=\bigcap_\fp\fa A_\fp
=\fa$.

Missing details in the hint:
\begin{itemize}
\item
Firstly for any $n\geq 1$, we have $\fp^nA_\fp\cap A=\fp^n$: the ``$\supset$''
is clear, and for ``$\subset$'', say $a\in A$ such that
$a=\frac{r}{s}\in\fp^nA_\fp\subset\Frac(A)$ for some $r\in\fp^n$ and $s\in A\setminus\fp$,
then we have $sa=r\equiv 0\pmod{\fp^n}$;
on the other hand, the prime ideals of the ring $A/\fp^n$ are one-to-one correspondence to the prime ideals $\fq$ of $A$ satisfying $\fp^n\subset\fq$,
which implies that $\fp=\sqrt{\fp^n}\subset\sqrt\fq=\fq$, since $\fp$ is a maximal ideal,
we must have $\fq=\fp$, namely $A/\fp^n$ is a local ring with maximal ideal
$\fp/\fp^n$, therefore $s$ is invertible in $A/\fp^n$ and which implies
$a\equiv 0\pmod{\fp^n}$.

Since $A_\fp$ is PID, $\fp A_\fp$ is principal, say $\fp A_\fp=gA_\fp$
for some $g\in\fp A_\fp$.
Then $\pi_\fp=gh$ for some $h\in A_\fp$.
We must have $h\notin\fp A_\fp$, otherwise $\pi_p\in\fp^2 A_\fp\cap A=\fp^2$, contradiction. Therefore $h\in A_\fp^\times$, which means that $\pi_\fp$ is also a generator of $\fp A_\fp$.

\item
The proof of $\fa=\bigcap_\fp\fa A_\fp$ is exactly the same as
Homework 3.3 (TODO), which is omitted.

\item
Since $\pi_\fp$ is a generator of $\fp A_\fp$
and $\pi_\fq\in A_\fp^\times$ for all $\fq\neq\fp$,
we have $fA_\fp=\fp^{e_\fp}A_\fp$.
On the other hand, $f_\fp\in\fp^{e_\fp}\setminus\fp^{e_\fp+1}$ implies that
$f_\fp=\pi_\fp^{e_\fp}g_\fp$ for some $g_\fp\in A_\fp$
and we must have $g_\fp\notin\fp A_\fp$, otherwise $f_\fp\in\fp^{e_\fp+1}A_\fp\cap A=\fp^{e_\fp+1}$, contradiction. Therefore $g_\fp\in A_\fp^\times$,
hence $fA_\fp=\fp^{e_\fp}A_\fp=f_\fp A_\fp$.
\end{itemize}
\end{proof}

\begin{prop}
\label{regular-domain-is-good}
\uses{semilocal-PID,ht-1-localization-is-PID}
A Noetherian regular domain satisfies \eqref{eqn:ht-1-localization-is-PID}.
\end{prop}

\begin{proof}
If $A$ is a Noetherian regular domain, then for each height one prime $\fp$ of $A$,
$A_\fp$ is a PID.
For any finitely many height one primes $\fp_1,\cdots,\fp_r$ of $A$,
let $S:=A\setminus\bigcup_{i=1}^r\fp_i$,
then $S^{-1}A$ is a semilocal integral domain, whose
maximal ideals are $S^{-1}\fp_1,\cdots,S^{-1}\fp_r$,
and we have $(S^{-1}A)_{S^{-1}\fp_i}=A_{\fp_i}$,
therefore by (i) we know that $S^{-1}A$ is a PID.
\end{proof}

\begin{remark}
In fact, a Noetherian integrally closed domain satisfies
\eqref{eqn:ht-1-localization-is-PID}.
\end{remark}

\section{Structure of Iwasawa module}

\subsection{Iwasawa algebra}

Let $p$ be a prime,
$\Gamma$ be a topological abelian group, isomorphic to $\BZ_p$
as a topological abelian group, and let $\gamma\in\Gamma$ be a topological generator
of $\Gamma$ (i.e.~the subgroup $\{\gamma^n\mid n\in\BZ\}$ is dense in $\Gamma$).
For each $n\geq 0$ let $\Gamma_n:=\Gamma/\Gamma^{p^n}$.

\begin{definition}
\label{Iwasawa-alg-defn}
The \emph{Iwasawa algebra} is defined as the completed group algebra
$$
\Lambda:=\BZ_p[[\Gamma]]:=\varprojlim_n\BZ_p[\Gamma_n],
$$
where the transition map $\BZ_p[\Gamma_{n+1}]\to
\BZ_p[\Gamma_n]$ is induced by the natural projection
$\Gamma_{n+1}\to\Gamma_n$.
Each $\BZ_p[\Gamma_n]$ is a free $\BZ_p$-module of rank $p^n$,
we endow it with the $p$-adic topology,
and endow $\Lambda$ with the subspace topology
of the product topology of $\prod_{n=0}^\infty\BZ_p[\Gamma_n]$.
\end{definition}

\begin{prop}
\label{linear-map-is-adic-continuous}
Let $A$ be a ring, $\fa$ be an ideal of $A$.
Let $M,N$ be two $A$-modules,
and $\varphi:M\to N$ be an $A$-module homomorphism.
Then $\varphi$ is continuous if we endow $M,N$ with $\fa$-adic topology.

In particular, if $\varphi$ is an $A$-module isomorphism,
then it is a homeomorphism of topological spaces if we endow $M,N$ with $\fa$-adic topology.
\end{prop}

\begin{proof}
Let $x\in M$ and $y:=\varphi(x)\in N$.
Let $U$ be any open neighborhood of $y$ in $N$.
Then there exists some $n$ such that $y+\fa^nN\subset U$.
Take $V=x+\fa^nM$ then it is an open neighborhood of $x$ in $M$,
and we have $\varphi(V)=y+\varphi(\fa^nM)=y+\fa^n\varphi(M)\subset y+\fa^nN\subset U$.
Therefore $\varphi$ is continuous.
\end{proof}

\begin{prop}
\label{Iwasawa-alg-isom-finite-level}
\uses{Iwasawa-alg-defn,linear-map-is-adic-continuous}
For each $n\geq 0$, there is an isomorphism of $\BZ_p$-algebras
$$
\BZ_p[\Gamma_n]\xrightarrow\sim\BZ_p[T]/\big((1+T)^{p^n}-1\big),\qquad
\gamma\mapsto 1+T.
$$
They are all free $\BZ_p$-modules of finite rank,
we endow them with $p$-adic topology.
By Proposition \ref{linear-map-is-adic-continuous}
we know that it is a homeomorphism of topological spaces.
\end{prop}

\begin{proof}
We have $\Gamma/\Gamma^{p^n}\cong\BZ/p^n\BZ$ as an abelian group,
and the image of $\gamma\in\Gamma$
in it is a generator of it. By abuse of notation we still denote the image of
$\gamma\in\Gamma$ in it by $\gamma$.
Then $\BZ[\Gamma/\Gamma^{p^n}]$ as a $\BZ$-module is free of rank $p^n$
and $\{\gamma^k\}_{0\leq k\leq p^n-1}$ is a basis of it.
Now it's easy to see that as a $\BZ_p$-module homomorphism,
$\BZ_p[\Gamma/\Gamma^{p^n}]\xrightarrow\sim\BZ_p[T]/\big((1+T)^{p^n}-1\big)$,
$\gamma^k\mapsto(1+T)^k$ is well-defined and is a $\BZ_p$-module isomorphism,
and preserves multiplication.
Therefore it is an isomorphism of $\BZ_p$-algebras.
\end{proof}

\begin{prop}
\label{Iwasawa-alg-isom}
\uses{Iwasawa-alg-isom-finite-level}
There is an isomorphism of topological rings
$\BZ_p[[T]]\xrightarrow\sim\Lambda$
sending $1+T$ to $\gamma$,
where $\BZ_p[[T]]$ is endowed with $(p,T)$-adic topology.
\end{prop}

\begin{proof}
We prove that there is a natural isomorphism of $\BZ_p$-algebras
$$
\varprojlim_n\BZ_p[T]/\big((1+T)^{p^n}-1\big)
\xrightarrow\sim\BZ_p[[T]],
$$
and which is a homeomorphism of topological spaces,
where the topology of the left hand side is the subspace topology
of the product topology of the topology defined in Proposition
\ref{Iwasawa-alg-isom-finite-level},
and the topology of the right hand side it the $(p,T)$-adic topology.
From which we can obtain the isomorphism of topological rings
$\Lambda\xrightarrow\sim\BZ_p[[T]]$ given by $\gamma\mapsto 1+T$.

For simplicity of notation, denote $\varphi_n(T):=(1+T)^{p^n}-1$.
It's easy to see that for each $n\geq 1$ and for all $1\leq i\leq p^n-1$,
we have $\binom{p^n}{i}\in p^n\BZ$,
hence $\varphi_n(T)\in T^{p^n}+p^n\BZ[T]_{\deg\leq p^n-1}$,
in particular $\varphi_n(T)$ is a distinguished polynomial of degree $p^n$.

It's clear that $\BZ_p[T]_{\deg\leq p^n-1}\xrightarrow\sim\BZ_p[T]/(\varphi_n(T))$
is an isomorphism of $\BZ_p$-modules,
and the Weierstrass division implies that
$\BZ_p[T]_{\deg\leq p^n-1}\xrightarrow\sim\BZ_p[[T]]/(\varphi_n(T))$
is also an isomorphism of $\BZ_p$-modules,
therefore the natural ring homomorphism $\BZ_p[T]\hookrightarrow\BZ_p[[T]]$
induces an isomorphism of $\BZ_p$-algebras
$\BZ_p[T]/(\varphi_n(T))\xrightarrow\sim\BZ_p[[T]]/(\varphi_n(T))$.

Since each $\BZ_p[[T]]/(\varphi_n(T))$ is a free $\BZ_p$-module of finite rank
endowed with the $p$-adic topology, we have
$\BZ_p[[T]]/(\varphi_n(T))\cong\varprojlim_m\BZ_p[[T]]/(p^m,\varphi_n(T))$,
where each $\BZ_p[[T]]/(p^m,\varphi_n(T))$ is endowed with discrete topology.
Therefore we have the following isomorphisms of rings as well as topological spaces:
\begin{align*}
\varprojlim_n\overbrace{\BZ_p[T]/(\varphi_n(T))}^{p\text{-adic topology}}
\xrightarrow\sim
\varprojlim_n\overbrace{\BZ_p[[T]]/(\varphi_n(T))}^{p\text{-adic topology}}
&\cong
\varprojlim_{m,n}\overbrace{\BZ_p[[T]]/(p^m,\varphi_n(T))}^{\text{discrete topology}} \\
&\stackrel{(*)}\cong
\varprojlim_k\overbrace{\BZ_p[[T]]/(p,T)^k}^{\text{discrete topology}}
\xrightarrow\sim
\overbrace{\BZ_p[[T]]}^{(p,T)\text{-adic topology}},
\end{align*}
here $(*)$ holds because $\{(p^m,\varphi_n(T))\}_{m\geq 1,n\geq 1}$
and $\{(p,T)^k\}_{k\geq 1}$ are \emph{cofinal}.
In fact, for each $k\geq 1$, and for any $m\geq k$ and $n\geq k$,
we have $(p^m,\varphi_n(T))\subset(p,T)^k$;
conversely, for each $m\geq 1$ and $n\geq 1$,
we have $(p,T)^{p^n}\subset(p,\varphi_n(T))$,
and $(p,\varphi_n(T))^m\subset(p^m,\varphi_n(T))$,
therefore for any $k\geq p^nm$, we have
$(p,T)^k\subset(p,T)^{p^nm}\subset(p,\varphi_n(T))^m\subset(p^m,\varphi_n(T))$.
\end{proof}

\subsection{Weierstrass preparation theorem}

This is WIP in \PR{21944}.

\begin{definition}
\label{distinguished-polynomial}
If $(A,\fm,k)$ is a local ring, then a polynomial $f(X)=\sum_{i=0}^na_iX^i\in A[X]$
is called a \emph{distinguished polynomial}
if $a_n=1$ and $a_i\in\fm$ for all $0\leq i\leq n-1$.
\end{definition}

\begin{prop}
\label{power-series-invertible-iff}
\leanok
Let $A$ be a ring, and let $f(X)=\sum_{n=0}^\infty a_nX^n\in A[[X]]$
be a formal power series.
Then $f(X)\in A[[X]]^\times$ if and only if $a_0\in A^\times$.

(This is already in mathlib: \docs{PowerSeries.isUnit_iff_constantCoeff})
\end{prop}

\begin{proof}
\leanok
If $f(X)\in A[[X]]^\times$,
then there exists $g(X)=\sum_{n=0}^\infty b_nX^n\in A[[X]]$
such that $f(X)g(X)=1$, therefore by considering constant term we obtain
$a_0b_0=1$, hence $a_0\in A^\times$.
Conversely, if $a_0\in A^\times$, by multiplying $a_0^{-1}$ to $f(X)$
if necessary, we may assume that $a_0=1$
and $f(X)=1-Xf_1(X)$ for some $f_1(X)\in A[[X]]$.
Since $A[[X]]$ is $(X)$-adically complete and separated,
it's easy to see that $1+\sum_{k=0}^\infty X^kf_1(X)^k$
converges $(X)$-adically in $A[[X]]$ and which is the inverse of
$f(X)$.
\end{proof}

\begin{prop}[Weierstrass division]
\label{weierstrass-division}
\uses{power-series-invertible-iff}
Let $(A,\fm,k)$ be a complete local ring,
$g(X)=\sum_{i=0}^\infty a_iX^i\in A[[X]]\setminus\fm[[X]]$ be a formal power series
such that not all of its coefficients are in $\fm$.
Let $n\geq 0$ be the integer such that $a_n\in A\setminus\fm=A^\times$
and $a_i\in\fm$ for all $0\leq i\leq n-1$.
Then for any $f\in A[[X]]$,
there exists a unique formal power series
$q(X)\in A[[X]]$ and a unique polynomial $r(X)\in A[X]$ of degree $\leq n-1$
such that $f=gq+r$.
\end{prop}

\begin{proof}
Write $g(X)=\sum_{i=0}^{n-1}a_iX^i+X^ng_1(X)$ for some $g_1(X)\in A[[X]]^\times$, and
$f(X)=\sum_{i=0}^{n-1}b_iX^i+X^nf_1(X)$ for some $f_1(X)\in A[[X]]$.
We construct a sequence $(q_k)_{k=1}^\infty$ inductively in $A[[X]]$,
such that $f-gq_k\in A[X]_{\deg\leq n-1}+\fm^k[[X]]$,
and such that $q_{k+1}(X)-q_k(X)\in\fm^k[[X]]$.
We construct $q_1(X):=f_1(X)g_1(X)^{-1}$.
Since $a_i\in\fm$ for all $i\leq n-1$, we have
\begin{align*}
f(X)-g(X)q_1(X)&=f(X)-\left(\sum_{i=0}^{n-1}a_iX^i\right)q_1(X)
-X^nf_1(X) \\
&=\sum_{i=0}^{n-1}b_iX^i-\left(\sum_{i=0}^{n-1}a_iX^i\right)q_1(X)
\in A[X]_{\deg\leq n-1}+\fm[[X]].
\end{align*}
Suppose $q_k(X)$ is constructed, then we may write
$f(X)-g(X)q_k(X)=\sum_{i=0}^{n-1}b_i^{(k)}X^i+X^ns_k(X)$
for some $s_k(X)\in\fm^k[[X]]$, and we construct
$q_{k+1}(X):=q_k(X)+s_k(X)g_1(X)^{-1}$. Then we have
\begin{align*}
f(X)-g(X)q_{k+1}(X)&=\sum_{i=0}^{n-1}b_i^{(k)}X^i+X^ns_k(X)
-\left(\sum_{i=0}^{n-1}a_iX^i\right)s_k(X)g_1(X)^{-1}
-X^ns_k(X) \\
&=\sum_{i=0}^{n-1}b_i^{(k)}X^i-\left(\sum_{i=0}^{n-1}a_iX^i\right)s_k(X)g_1(X)^{-1}
\in A[X]_{\deg\leq n-1}+\fm^{k+1}[[X]].
\end{align*}

Since $A[[X]]$ is complete and separated according to the sequence
$\{\fm^k[[X]]\}_{k\geq 1}$ of ideals, there exists a unique limit $q(X)\in A[[X]]$
of the sequence $(q_k)_{k=1}^\infty$, which satisfies $r:=f-gq\in A[X]_{\deg\leq n-1}$.

To prove the uniqueness, suppose $q(X)\in A[[X]]$ and $r(X)\in A[X]_{\deg\leq n-1}$
such that $gq=r$, then we prove by induction that for any $k\geq 0$
we have $q,r\in\fm^k[[X]]$, which implies that $q=r=0$.
When $k=0$ there is nothing to prove. Suppose $q,r\in\fm^k[[X]]$ for some $k\geq 0$.
Then we have $(\sum_{i=0}^{n-1}a_iX^i)q(X)+X^ng_1(X)q(X)=r(X)$,
since $a_i\in\fm$ for all $i\leq n-1$, we obtain $r(X)\in\fm^{k+1}[X]_{\deg\leq n-1}$.
Multiply $g_1(X)^{-1}$ to both side,
we obtain $(\sum_{i=0}^{n-1}a_iX^i)q(X)g_1(X)^{-1}+X^nq(X)=r(X)g_1(X)^{-1}$,
therefore $q(X)\in\fm^{k+1}[[X]]$.
\end{proof}

\begin{prop}[Weierstrass preparation theorem]
\label{weierstrass-preparation}
\uses{weierstrass-division,distinguished-polynomial}
Let $(A,\fm,k)$ be a complete local ring.
Let $g(X)\in A[[X]]\setminus\fm[[X]]$ be a formal power series
such that not all of its coefficients are in $\fm$.
Then there is a unique distinguished polynomial $f(X)\in A[X]$
and a unique invertible formal power series $h(X)\in A[[X]]^\times$ such that $g=fh$.
\end{prop}

\begin{proof}
Take $f(X)=X^n$ in Proposition \ref{weierstrass-division}, we obtain $q(X)\in A[[X]]$
and $r(X)\in A[X]_{\deg\leq n-1}$ such that $X^n=g(X)q(X)+r(X)$.
Since $g(X)=\sum_{i=1}^{n-1}a_iX^i+X^ng_1(X)$
with $a_i\in\fm$ for all $i\leq n-1$ and $g_1(X)\in A[[X]]^\times$,
we have $r(X)\in\fm[X]_{\deg\leq n-1}$, and by the construction in (ii)
we have $q(X)\in g_1(X)^{-1}+\fm[[X]]\subset A[[X]]^\times$.
Therefore take $h(X):=q(X)^{-1}\in A[[X]]^\times$
and $f(X):=X^n-r(X)$, then $f(X)$ is a distinguished polynomial of degree $n$,
and $g(X)=f(X)h(X)$ holds.

To prove the uniqueness, suppose $f(X)$ and $f'(X)$ are two distinguished polynomials
and $u(X)\in A[[X]]^\times$ such that $f'(X)=f(X)u(X)$.
Then $\overline u(X)\in k[[X]]^\times$ and we have
$\overline f{}'(X)=X^{\deg(f')}=\overline f(X)\overline u(X)
=X^{\deg(f)}\overline u(X)\in k[[X]]^\times$,
which forces that $\deg(f)=\deg(f')$ and $\overline u(X)=1$.
Therefore $f'(X)-f(X)\in A[X]_{\deg\leq\deg(f)-1}$
and $f'(X)=f(X)+(f'(X)-f(X))$ is a Weierstrass division of $f'$ by $f$,
on the other hand, $f'(X)=f(X)u(X)$ is also a Weierstrass division of $f'$ by $f$,
hence by the uniqueness of Weierstrass division
we have $u(X)=1$ and $f'(X)=f(X)$.

(\emph{Another proof.}
It is possible to prove Weierstrass preparation theorem using a form
of Hensel's lemma presented in \url{https://ncatlab.org/nlab/show/Hensel's+lemma}.)
\end{proof}

\subsection{Characteristic ideal}

Note that $\Lambda\cong\BZ_p[[T]]$ is a
Noetherian regular local ring of Krull dimension $2$.
Hence by Proposition \ref{regular-local-ring-is-UFD} it is a UFD
(or maybe one can check directly that the $I$-adic completion of a UFD is a UFD),
by Proposition \ref{UFD-iff-ht-1-principal} any height $1$ prime $\fp$ of $\Lambda$
is principal.
If the generator of $\fp$ is in $p\BZ_p[[T]]$, then
we must have $\fp=(p)$.
If the generator of $\fp$ is not in $p\BZ_p[[T]]$, then
by Proposition \ref{weierstrass-preparation} such $\fp$
has a unique generator which is a distinguished polynomial.

Therefore, if $X$ is a finitely generated torsion $\Lambda$-module,
then there exists a pseudo-isomorphism
$$
X\to\bigoplus_{i=1}^m\Lambda/(f_i^{b_i})\oplus\bigoplus_{j=1}^s\Lambda/(p^{n_j})
$$
where $f_1,\cdots,f_m$ are distinguished polynomials.
The characteristic ideal $\chaR_\Lambda(X)$ is generated by
$p^{\sum_{j=1}^sn_j}\prod_{i=1}^mf_i^{b_i}$
which is contained in $p^{\sum_{j=1}^sn_j}\BZ_p[[T]]$
but not in $p^{1+\sum_{j=1}^sn_j}\BZ_p[[T]]$.

\begin{definition}
\label{iwasawa-mod-invariants}
The $\mu$-invariant of $X$
is defined to be $\mu(X):=\sum_{j=1}^sn_j$,
and the $\lambda$-invariant of $X$
is defined to be $\lambda(X):=\sum_{i=1}^mb_i\deg f_i$.
\end{definition}

We can also define invariants of power series:

\begin{definition}
\label{power-series-invariants}
If $f\in\BZ_p[[T]]$ is not zero, then define
$\mu(f)$ be the integer such that
$f\in p^{\mu(f)}\BZ_p[[T]]$ but
$f\notin p^{1+\mu(f)}\BZ_p[[T]]$,
define $\lambda(f)$ be the leading degree of
$(p^{-\mu(f)}f\bmod p)\in\BF_p[[T]]$.
\end{definition}

Clearly, $\mu(X)$ and $\lambda(X)$ are equal to
$\mu(f)$ and $\lambda(f)$ if $\chaR_\Lambda(X)=(f)$.

\begin{prop}
\label{iwasawa-mod-invariants-2}
We have $\mu(X)=\sum_{i=0}^\infty\rank_{\BF_p[[T]]}X[p^{i+1}]/X[p^i]$,
$\lambda(X)=\rank_{\BZ_p}X/X[p^\infty]$,
and $\chaR_\Lambda(X)=(p^{\mu(X)}h_X(T))\subset\Lambda$,
where $h_X(T)$ is the characteristic polynomial of $T$ acts on
$X\otimes_{\BZ_p}\BQ_p$.
\end{prop}

......

\subsection{Growth of coinvariant part}

\begin{prop}
\label{coinvariant-growth}
If $X$ is a finitely generated torsion
$\Lambda$-module such that $X/(\gamma^{p^n}-1)X$ is finite
for any $n\geq 0$, then
there exists some constant $\nu=\nu(X)$
such that for all sufficiently large $n$,
$\ord_p(\#(X/(\gamma^{p^n}-1)X))=\mu(X)p^n
+\lambda(X)n+\nu(X)$.
\end{prop}

\appendix

\section{Known results in mathlib}

\subsection{Rings}

\begin{itemize}
\item
Commutative ring with unit \docs{CommRing}
\item
Field \docs{Field}
\begin{itemize}
\item
assertion that a ring is a field \docs{IsField}
\end{itemize}
\item
assertion that a ring is an integral domain \docs{IsDomain}
\item
assertion that a ring is PID: \docs{IsDomain} + \docs{IsPrincipalIdealRing}
\item
assertion that a ring is UFD: \docs{IsDomain} + \docs{UniqueFactorizationMonoid}
\item
Noetherian ring \docs{IsNoetherianRing}
\begin{itemize}
\item
finitely many minimal prime ideals
\docs{minimalPrimes.finite_of_isNoetherianRing}
\item
finitely many minimal prime over-ideals
\docs{Ideal.finite_minimalPrimes_of_isNoetherianRing}
\end{itemize}
\item
Artin ring \docs{IsArtinianRing}
\begin{itemize}
\item
it is also Noetherian \docs{instIsNoetherianRingOfIsArtinianRing}
(instance, shouldn't need to call directly)
\end{itemize}
\item
Characteristic of a ring \docs{ringChar}, exponential characteristic \docs{ringExpChar}
\begin{itemize}
\item
assertion that a ring is of specific characteristic
\docs{CharZero}, \docs{CharP}, \docs{ExpChar}
\end{itemize}
\item
Krull dimension of a ring \docs{ringKrullDim}
\begin{itemize}
\item
assertion that a ring is of Krull dimension $\leq n$
\docs{Ring.KrullDimLE}
\item
assertion that a ring is of Krull dimension $\leq 1$
\docs{Ring.DimensionLEOne}
\end{itemize}
\end{itemize}

\subsection{Ideals}

\begin{itemize}
\item
Ideal of a ring \docs{Ideal}
\begin{itemize}
\item
assertion that an ideal is principal \docs{Submodule.IsPrincipal}
\item
assertion that an ideal is a prime ideal \docs{Ideal.IsPrime}
\begin{itemize}
\item
\docs{Ideal.Quotient.isDomain_iff_prime}
\end{itemize}
\item
assertion that an ideal is a maximal ideal \docs{Ideal.IsMaximal}
\begin{itemize}
\item
\docs{Ideal.Quotient.maximal_ideal_iff_isField_quotient}
\item
\docs{Ideal.Quotient.field} (instance, shouldn't need to call directly)
\end{itemize}
\end{itemize}
\item
Height of an ideal \docs{Ideal.height},
height of a prime ideal \docs{Ideal.primeHeight}
\begin{itemize}
\item
assertion that an ideal is the whole ring or of finite height \docs{Ideal.FiniteHeight}
\end{itemize}
\item
the \verb|Type| of prime ideals of a ring $\Spec(R)$ \docs{PrimeSpectrum}
\item
set of minimal primes \docs{minimalPrimes},
set of minimal prime over-ideals \docs{Ideal.minimalPrimes}
\end{itemize}

\subsection{Modules}

\begin{itemize}
\item
Support of a module $\Supp(M)$ \docs{Module.support}
\item
Annihilator of a module $\Ann(M)$ \docs{Module.annihilator}
\item
$M^*=\Hom_\BZ(M,\BQ/\BZ)$ \docs{CharacterModule}
\item
Associated primes of a module $\Ass(M)$ \docs{associatedPrimes}
\item
Noetherian module \docs{IsNoetherian}
\item
Artin module \docs{IsArtinian}
\item
assertion that a module is of finite length \docs{IsFiniteLength}
\begin{itemize}
\item
in the statement of theorems use \docs{IsNoetherian} + \docs{IsArtinian} instead
\item
length of a module $\ell_A(M)$ \textbf{UNDEFINED !!!}
\begin{itemize}
\item
preliminary: \PR{22127}, \PR{21800}, \PR{21803}
\end{itemize}
\end{itemize}
\item
composition series \docs{CompositionSeries}
\begin{itemize}
\item
usage:

\verb|∃ (s : |\docs{CompositionSeries}\verb| (|\docs{Submodule}%
\verb| R M)), |\docs{RelSeries.head}\verb| s = ⊥ ∧ |\docs{RelSeries.last}\verb| s = ⊤|
\end{itemize}
\end{itemize}

\subsection{Number theory}

\begin{itemize}
\item
assertion that a field is a number field (i.e.~finite extension of $\BQ$)
\docs{NumberField}
\item
ring of integers $\CO_K$ \docs{NumberField.RingOfIntegers}
\item
assertion that a ring is a Dedekind domain \docs{IsDedekindDomain}
\begin{itemize}
\item
unique factorization of ideals \docs{Ideal.uniqueFactorizationMonoid}
(instance, shouldn't need to call directly)
\end{itemize}
\item
fraction ideals \docs{FractionalIdeal}
\begin{itemize}
\item
usage: if $R$ is a domain, $K$ is fraction field of $R$,
then the \verb|Type| of fraction ideals in $K$ is:

\docs{FractionalIdeal}\verb| (|\docs{nonZeroDivisors}\verb| R) K|
\item
$\ord_\fp(\fa)$ \docs{FractionalIdeal.count}
\end{itemize}
\item
ideal class group \docs{ClassGroup}
\begin{itemize}
\item
finite \docs{NumberField.RingOfIntegers.instFintypeClassGroup}
(instance, shouldn't need to call directly)
\item
class number \docs{NumberField.classNumber}
\end{itemize}
\item
places of a number field $K$:
\docs{AbsoluteValue}\verb| K ℝ|, \docs{NumberField.place}
\begin{itemize}
\item
infinite places \docs{NumberField.InfinitePlace}
\item
real and complex places
\docs{NumberField.InfinitePlace.IsReal},
\docs{NumberField.InfinitePlace.IsComplex}
\item
$r_1,r_2$
\docs{NumberField.InfinitePlace.nrRealPlaces},
\docs{NumberField.InfinitePlace.nrComplexPlaces}
\item
$r_1+r_2-1$
\docs{NumberField.Units.rank}
\item
Dirichlet unit theorem
\docs{NumberField.Units.rank_modTorsion}
\end{itemize}
\item
assertion that a field extension is cyclotomic
\docs{IsCyclotomicExtension}
\begin{itemize}
\item
cyclotomic field $K(\mu_n)$
\docs{CyclotomicField}
\end{itemize}
\item
$p$-adic cyclotomic character:
if $\mu_{p^\infty}\subset L$
then $\chi_\cyc:\Aut(L)\to\BZ_p^\times$
\PR{21934}
\end{itemize}
